# Appendix 01. Gurgle packet

## Version

Request:
```json
    {"id": id, "version": client_protocol_version}
```

Response:
```json
    {"id": id, "version": server_protocol_version}
```

## Ping

Request:
```json
    {"id": id, "cmd": "ping", "data": data}
```

Response:
```json
    {"id": id, "cmd": "pong", "data": data}
```

## Payload upgrade

Request:
```json
    {"id": id, "cmd": "upgrade", "features": [list_of_features]}
```

Response:
```json
    {"id": id, "cmd": "upgraded", "features": [list_of_features], "error": null}
    {"id": id, "cmd": "upgraded", "features": [list_of_features_enabled], "error": error_type, "reason": human_readable_error_description}
```

## Authentication method

Request:
```json
    {"id": id, "cmd": "query", "query": "auth"}
```

Response:
```json
    {"id": id, "answer": ["plain"]}
```

## Plain text authentication

Request:
```json
    {"id": id, "cmd": "auth", "from": gurgle_id, "method": "plain", "password": password}
```

Response:
```json
    {"id": id, "to": full_gurgle_id, "error": null}
    {"id": id, "to": full_gurgle_id, "error": "password", "reason": "Incorrect username or password."}
    {"id": id, "to": full_gurgle_id, "error": "user_disable", "reason": "Your account has been disabled or deactivated."}
```

## Publishing presence

Request:
```json
    {"id": id, "cmd": "presence", "presence": {"status": "available"/"away"/"dnd"/"invisible", "mood": mood_text}}
```

Response:
```json
    {"id": id, "cmd": "presence", "presences": [{"from": full_gurgle_id, "status": "available"/"away"/"dnd"/"invisible", "mood": mood_text, "error": null}]}
```

## Receiving presence update

Response:
```json
    {"id": null, "cmd": "presence", "presences": [{"from": full_gurgle_id, "status": "available"/"away"/"dnd"/"invisible"/null, "mood": mood_text, "error": null}]}
```

## Requesting roaster

Request:
```json
    {"id": id, "cmd": "get_roaster"}
    {"id": id, "cmd": "get_roaster", "etag": old_cache_etag}
```

Response:
```json
    {"id": id, "cmd": "keep_roaster", "etag": old_cache_tag}
    {"id": id, "cmd": "flush_roaster", "etag": new_cache_tag, "roaster": [{"from": bare_gurgle_id, "name": nickname, "bio": short_description, "alias": alias, "type": "peer"/"chatroom", "subscription": "both"/"to"/"from"/null, "presence": [terminal: {presence}], ...}]}
```

## Receiving roaster update

Response:
```json
    {"id": id, "cmd": "update_roaster", "etag": new_cache_tag, "roaster": [{"from": bare_gurgle_id, "name": nickname, "bio": short_description, "alias": alias, "type": "peer"/"chatroom", "subscription": "both"/"to"/"from"/null, "presence": [terminal: {presence}], ...}]}
```

## Requesting roaster update

Request:
```json
    {"id": id, "cmd": "update_roaster", "etag": new_cache_tag, "roaster": [{"from": bare_gurgle_id, "alias": alias, "delete": true/false}]}
```

Response:
```json
    {"id": id, "cmd": "update_roaster", "etag": new_cache_tag, "roaster": [{"from": bare_gurgle_id, "name": nickname, "bio": short_description, "alias": alias, "type": "peer"/"chatroom", "subscription": "both"/"to"/"from"/null, "presence": [terminal: {presence}], ...}]}
```

## Sending message

Request:
```json
    {"id": id, "cmd": "message", "messages": [{"id": message_id, "timestamp": unix_timestamp, "to": gurgle_id, "text": text_version, "html": html_version, "attachments": [{"name": attachment_name, "type": mime_type, "blob": blob_content}]}]}
```

Response:
```json
    {"id": id, "cmd": "sent", "success": [message_id], "failure": [message_id], "error": error_type, "reason": human_readable_error_description}
```

## Receiving message

Response:
```json
    {"id": id, "cmd": "message", "messages": [{"id": message_id, "timestamp": unix_timestamp, "from": full_gurgle_id, "text": text_version, "html": html_version, "attachments": [{"id": attachment_id, "name": attachment_name, "type": mime_type, "size": size_in_bytes, "token": token_to_retrieve_attachment}]}]}
```

## Polite quit

Request:
```json
    {"id": id, "cmd": "quit", "reason": quit_reason}
```

Response:
```json
    {"id": id, "cmd": "bye"}
```

## Emergency quit

Request:
```json
    {"id": id, "cmd": "kill", "error": error_type, "reason": human_readable_error_description}
```
