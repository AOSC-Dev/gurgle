# Appendix 01. Gurgle packet

## Version

Request:
```json
    {"id": id, "version": client_protocol_version}
```

Response:
```json
    {"id": id, "version": server_protocol_version}
```

## Ping

Request:
```json
    {"id": id, "cmd": "ping", "payload": data}
```

Response:
```json
    {"id": id, "cmd": "pong", "payload": data}
```

## Payload upgrade

Request:
```json
    {"id": id, "cmd": "upgrade", "params": {"features": [list_of_features]}}
```

Response:
```json
    {"id": id, "cmd": "upgraded", "params": {"features": [list_of_features]}, "error": null}
    {"id": id, "cmd": "upgraded", "params": {"features": [list_of_features_enabled]}, "error": error_type, "reason": human_readable_error_description}
```

## Authentication method

Request:
```json
    {"id": id, "cmd": "query", "params": {"query": "encrypted_method"}}
```

Response:
```json
    {"id": id, "params": {"answer": ["plain_password"]}}
```

## Plain text authentication

Request:
```json
    {"id": id, "cmd": "auth", "from": gurgle_id, "params": {"method": "plain_password", "password": password}}
```

Response:
```json
    {"id": id, "to": full_gurgle_id, "error": null}
    {"id": id, "to": full_gurgle_id, "error": "password", "reason": "Incorrect username or password."}
    {"id": id, "to": full_gurgle_id, "error": "user_disabled", "reason": "Your account has been disabled or deactivated."}
```

## get authenticated status

Request:
```json
    {"id":"id", "cmd","query", "params":{"query":"auth_status"}}
```

Response:
```json
    {"id":"id", "params":{"answer":"Authenticated/Unauthenticated"}}
```

## Push something

Request:
```json
{
    "id"    : "id",
    "cmd"   : "push",
    TARGET_1: {
        Item_1{
            Data
        }
        Item_2{
            Data
        }
        ......
    }
    TARGET_2: {
        Item_1{
            Data
        }
        Item_2{
            Data
        }
        ......
    }

}
```

Response:
```json
{
    "id"    : "id",
    "cmd"   : "push",
    TARGET_1:{
        Item_1{
            Data
            error = null
        }
        Item_2{
            Data
            error = null
        }
        Item_3{
            Data
            error = human-readable descriptions
        }
    }
}
```
*Note: Item_1 and Item_2 were pushed successfully*
*Note: We failed to push Item_3, so it returns Item_3's all data currently*
*Note:     and error field with human-readable description*

## Publishing presence

Request:
```json
{
    "id"    : id, 
    "cmd"   : "push", 
    "presence": {
        full_gurgle_id{
            "status"    : ("available"/"away"/"dnd"/"invisible")/null,
            "mood"      : mood_text/null
            "first_name": first_name/null
            "last_name" : last_name/null
            "nickname"  : nickname/null
        }
        full_gurgle_id{
            "status"    : ("available"/"away"/"dnd"/"invisible")/null,
            "mood"      : mood_text/null
            "first_name": first_name/null
            "last_name" : last_name/null
            "nickname"  : nickname/null
        }
        ......
    }
}
```
*Note: You can not push your presence with nickname field*
*Note: If you do not want to push some fields, just do not insert the field or fill with None or null*
*Note: All disabled but nickname if id is specified as your friend*

Response:
```json
{
    "id"    : id, 
    "cmd"   : "push", 
    "presences" : {
        full_gurgle_id:{
            "status"    : "available"/"away"/"dnd"/"invisible", 
            "mood"      : mood_text, 
            "first_name": your_first_name/null
            "last_name" : your_last_name/null
            "nickname"  : nickname/null
            "error"     : null
        }
        full_gurgle_id:{
            "status"    : "available"/"away"/"dnd"/"invisible", 
            "mood"      : mood_text, 
            "first_name": your_first_name/null
            "last_name" : your_last_name/null
            "nickname"  : nickname/null
            "error"     : human-readable descriptions
        }
    }
}
```
*Note: If persences pushed successfully, It will return data and error field with null*
*Note: If you do not want to push some fields, just do not insert the field or fill with None or null*
*Note: If any errors arised, It will return all details and error fields with human-readable descriptions*

## Receiving presence update

Response:
```json
{
    "id": null, 
    "cmd": "push",
    "presences": {
        full_gurgle_id:{
            "status"    : "available"/"away"/"dnd"/"invisible"/null, 
            "mood"      : mood_text, 
            "first_name": your_first_name/null
            "last_name" : your_last_name/null
            "nickname"  : nickname/null
            "error"     : null
        }
    }
}
```

## Request presence update

Response:
```json
{
    "id": null, 
    "cmd": "pull",
    "presences": {
        gurgle_id,
        gurgle_id,
        gurgle_id
    }
}

## Requesting roster

Request:
```json
    {"id": id, "cmd": "pull", "params": {"roster"}}
    {"id": id, "cmd": "pull", "params": {"roster":{"etag": old_cache_etag}}}
```

Response:
```json
    {"id": id, "cmd": "keep_roster", "params": {"etag": old_cache_tag}}
    {"id": id, "cmd": "flush_roster", "params": {"etag": new_cache_tag, "roster": [{"from": bare_gurgle_id, "name": nickname, "bio": short_description, "alias": alias, "type": "peer"/"chatroom", "subscription": "both"/"to"/"from"/null, "presence": [terminal: {presence}], ...}]}}
```

## Receiving roster update

Response:
```json
{
    "id": id,
    "cmd": "update_roster", 
    "params": {
        "etag": new_cache_tag,
        "roster": 
            [{
                "from": bare_gurgle_id, 
                "name": nickname, 
                "bio": short_description, 
                "alias": alias, 
                "type": "peer"/"chatroom", 
                "subscription": "both"/"to"/"from"/null,
                "presence": [terminal: {presence}], ...
        }]
    }
}
```

## Requesting roster update

Request:
```json
    {"id": id, "cmd": "update_roster", "params": {"etag": new_cache_tag, "roster": [{"from": bare_gurgle_id, "alias": alias, "delete": true/false}]}}
```

Response:
```json
    {"id": id, "cmd": "update_roster", "params": {"etag": new_cache_tag, "roster": [{"from": bare_gurgle_id, "name": nickname, "bio": short_description, "alias": alias, "type": "peer"/"chatroom", "subscription": "both"/"to"/"from"/null, "presence": [terminal: {presence}], ...}]}}
```

## Sending message

Request:
```json
    {"id": id, "cmd": "message", "params": {"messages": [{"id": message_id, "timestamp": unix_timestamp, "to": gurgle_id, "content": [{"name": attachment_name, "type": mime_type, "blob": blob_content}], "text": text_version}]}}
```

Response:
```json
    {"id": id, "cmd": "sent", "params": {"success": [message_id], "failure": [message_id]}, "error": error_type, "reason": human_readable_error_description}
```

## Receiving message

Response:
```json
    {"id": id, "cmd": "message", "params": {"messages": [{"id": message_id, "timestamp": unix_timestamp, "from": full_gurgle_id, "content": [{"name": attachment_name, "type": mime_type, "blob": blob_content, "size": size_in_bytes, "token": token_to_retrieve_attachment}], "text": text_version}]}}
```

## Polite quit

Request:
```json
    {"id": id, "cmd": "quit", "reason": quit_reason}
```

Response:
```json
    {"id": id, "cmd": "bye"}
```

## Emergency quit

Request:
```json
    {"id": id, "cmd": "kill", "error": error_type, "reason": human_readable_error_description}
```
